#include "car.h"

int L,C;

/**Pour récupérer les coordonnées (x,y) du clic de la souris**/
int click_souris()
{
  MEVENT event ;
  int ch;
  while((ch = getch()) != KEY_F(1)) {
    switch(ch) {
      case KEY_F(2): /*Pour quitter la boucle*/
				return 1;
      case KEY_MOUSE:
        if(getmouse(&event) == OK) {
					C = event.x;
					L = event.y;
					if(event.bstate & BUTTON1_CLICKED) return 0;
				}
    }
  }
  return 0;
}

int main(int argc, char** argv) {

	srand(time(NULL));
	char tab[NBLIN][NBCOL];
	
	FILE* file = fopen("./txt/map.txt", "r");
	if(file == NULL){
	printf("Can't open the map.txt file\n");
	} 	
	loadMap(file,NBLIN,NBCOL,tab);
	fseek(file, 0, SEEK_SET);
	fclose(file);
	
	initscr();
	ncurses_initialiser();
	ncurses_couleurs();
	ncurses_souris();
	displayTab(NBLIN,NBCOL,tab);
	refresh();
	
	car* car=spawnCar(SPAWNX,SPAWNY-5,1, NBLIN,NBCOL,tab);
	while (/*click_souris()==0*/1) {
		mvprintw(50,0,"y : %d, x : %d   ", car->posy, car->posx);
		moveCar(car, NBLIN,NBCOL,tab);
		refresh();
	
		usleep(70000);
	}
	endwin();

}
